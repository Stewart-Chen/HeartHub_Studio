:root{
  --bg:#f6f7fb; --card:#ffffff; --text:#1f2633; --muted:#5b6577; --line:#e3e7f0;
  --brand:#00A497; --accent:#24c7b6; --shadow:0 6px 18px rgba(0,0,0,.06);
  /* 類別點顏色往品牌系統靠攏 */
  --t-course:#008c86; --t-data:#00a497; --t-incub:#24c7b6; --t-commerce:#59dacd;
}
html[data-theme="dark"]{
  --bg:#0b1212; --card:#10181a; --text:#e7f4f2; --muted:#a9c4c0; --line:#1f2c2b;
  --shadow:0 8px 24px rgba(0,0,0,.5);
}

/* 基礎 */
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);
  font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;line-height:1.58}

/* Header */
header{max-width:1200px;margin:22px auto 8px;padding:0 16px;
  display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center}
.logo{display:flex;align-items:center;gap:12px}
.logo-img,.logo-svg{width:42px;height:42px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.1))}
.name,.brand{font-weight:900;letter-spacing:.2px;font-size:20px}
.sub,.brand-sub{font-weight:700;color:var(--muted);margin-left:6px}
.note{color:var(--muted);font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap;justify-self:end}
.btn,select{border:1px solid var(--line);background:var(--card);color:var(--text);
  padding:9px 12px;border-radius:10px;box-shadow:var(--shadow);cursor:pointer;font-size:14px}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:var(--brand);color:#fff;border-color:transparent}
.btn.primary:hover{filter:brightness(1.05)}
select{height:36px}

/* Tabs */
.tabs{max-width:1200px;margin:6px auto 12px;padding:0 16px;display:flex;gap:10px;flex-wrap:wrap}
.tab{padding:10px 16px;border-radius:999px;border:1px solid var(--line);background:var(--card);box-shadow:var(--shadow);color:var(--text);cursor:pointer}
.tab:hover{border-color:var(--brand)}
.tab.active{background:linear-gradient(135deg,var(--brand),var(--accent));color:#fff;border-color:transparent}
.page{display:none} .page.active{display:block}

/* Toolbar & Chips */
.toolbar{max-width:1200px;margin:6px auto 8px;padding:0 16px;display:flex;gap:14px;flex-wrap:wrap;align-items:center}
.group{display:flex;gap:8px;align-items:center}
.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--card);box-shadow:var(--shadow);font-size:14px;transition:.2s ease}
.chip:hover{border-color:var(--brand)}
.chip input{transform:translateY(1px)}
.chip .dot{width:10px;height:10px;border-radius:50%}
.dot-course{background:var(--t-course)} .dot-data{background:var(--t-data)}
.dot-incub{background:var(--t-incub)} .dot-commerce{background:var(--t-commerce)}

/* Canvas/Card */
.canvas{max-width:1200px;margin:0 auto 36px;padding:0 16px 16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);position: relative;overflow: hidden;padding:0}
.card-body {
  padding: 18px;
}
/* ===== BMC（統一三欄 + 響應式）===== */
.grid{
  display:grid; gap:14px;
  grid-template-columns:repeat(3, minmax(0,1fr));
}
.cell{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:var(--shadow);
  display:flex;flex-direction:column;min-height:180px;position:relative;transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease}
.cell h3{margin:0 0 8px;font-size:14px;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.cell h3 .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
.cell ul{margin:0;padding-left:18px}
.cell li{margin:6px 0}
.muted{color:var(--muted)}
.tag{display:inline-block;border-radius:999px;padding:2px 8px;font-size:11px;font-weight:700;color:#fff;margin-left:6px}
.t-course{background:var(--t-course)} .t-data{background:var(--t-data)}
.t-incub{background:var(--t-incub)} .t-commerce{background:var(--t-commerce)}
.hide-tags .tag{display:none}

/* 取消舊版 5 欄布局（若有殘留不影響，但這裡顯式清掉） */
#kp,#ka,#vp,#cr,#ch,#kr,#cs,#cost,#rev{grid-area:auto}

/* 單一區塊放大模式 */
.single-view .cell{opacity:.18;filter:grayscale(35%)}
.single-view .cell.focus{opacity:1 !important;filter:none !important;transform:scale(1.08);border-color:transparent;box-shadow:0 14px 36px rgba(0,0,0,.20);z-index:3}
.hidden{display:none !important}

/* 斷點 */
@media (max-width:1024px){
  .grid{grid-template-columns:repeat(2, minmax(0,1fr));}
}
@media (max-width:640px){
  .grid{grid-template-columns:1fr;}
  .cell{min-height:auto}
  .cell{padding:12px;border-radius:10px}
  .cell h3{font-size:15px;margin-bottom:6px}
  .cell li{margin:4px 0}
  .toolbar{gap:8px}
  .tabs{gap:8px}
  header{
    grid-template-columns: 1fr; /* 由橫排改成一欄直排 */
    gap: 8px;
    align-items: start;
  }
  .logo{ align-items: flex-start; }

  .name{ font-size: 18px; }
  .sub{
    font-size: 14px;
    line-height: 1.4;
    word-break: keep-all;
  }

  /* 右側按鈕群組可換行、在手機上兩顆一排 */
  .controls{
    justify-self: stretch;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .controls .btn{
    flex: 1 1 calc(50% - 8px); /* 兩顆一排；太窄時自動掉到下一行 */
  }
}
/* 小螢幕：標籤列可橫向捲動，避免擠成多行 */
@media (max-width:480px){
  .tabs{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch}
  .tab{white-space:nowrap}
}
/* ===== Roadmap ===== */
.road{display:grid;gap:14px}
.swim{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow)}
.swim h4{margin:0;padding:12px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:8px}
.swim .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:14px}
.block{border:1px dashed var(--line);border-radius:10px;padding:10px;background:rgba(0,0,0,.02)}
.y{font-size:12px;color:var(--muted);margin-bottom:6px}

/* ===== Venn ===== */
.venn-wrap{display:flex;gap:28px;align-items:center;justify-content:center;flex-wrap:wrap}
.venn{position:relative;width:500px;height:400px;isolation:isolate}
.circle{position:absolute;border-radius:50%;opacity:.6}
.c1{background:#00A497;width:300px;height:300px;left:40px;top:30px}
.c2{background:#1bc7b2;width:300px;height:300px;left:180px;top:30px}
.c3{background:#6fe0d5;width:300px;height:300px;left:110px;top:90px}
html[data-theme="dark"] .circle{mix-blend-mode:screen;opacity:.72}
html[data-theme="light"] .circle{mix-blend-mode:multiply}
.venn-label{position:absolute;font-weight:700;text-shadow:0 2px 6px rgba(0,0,0,.18)}
.l1{left:80px;top:6px} .l2{left:340px;top:6px} .l3{left:210px;top:312px}
.venn-center{position:absolute;left:200px;top:170px;font-weight:800;text-shadow:0 2px 6px rgba(0,0,0,.18);font-size:18px}
.venn-legend{min-width:180px}
.venn-legend h4{margin:0 0 10px}
.venn-legend ul{margin:0;padding-left:18px}

/* 編輯提示 */
.edit-tip{position:fixed;right:16px;bottom:16px;background:var(--card);color:var(--muted);
  border:1px dashed var(--line);border-radius:10px;padding:8px 12px;box-shadow:var(--shadow);font-size:12px;display:none}

/* 列印 */
@page{size:A4;margin:14mm}
@media print{
  header,.tabs,.toolbar,.edit-tip{display:none}
  body{background:#fff}
  .canvas{padding:0}
  .cell,.swim,.venn-wrap{break-inside:avoid}
}
/* 讓容器不要外溢 */
.venn-wrap{max-width:100%; overflow:hidden}
.venn{margin:0 auto}

/* 640px 以下：縮圈圈 + 重新定位 */
@media (max-width:640px){
  .venn{width:360px;height:300px}
  .c1,.c2,.c3{width:240px;height:240px}
  .c1{left:20px; top:20px}
  .c2{left:120px; top:20px}   /* ← 原本 180px 會外溢，改 120px */
  .c3{left:70px;  top:70px}
  .l1{left:44px; top:-4px}
  .l2{left:230px;top:-4px}
  .l3{left:130px;top:250px}
  .venn-center{left:170px;top:140px}
}

/* 更窄（~360px）再縮一級，保證不外溢 */
@media (max-width: 360px){
  .venn{width: 300px;height:260px}
  .c1,.c2,.c3{width: 150px;height: 150px;}
  .c1{left: 15px;top:15px}
  .c2{left:105px;top:15px}
  .c3{left:60px; top:60px}
  .l1{left: 16px;top:-2px}
  .l2{left: 150px;top:-2px}
  .l3{left: 80px;top:210px}
  .venn-center{left: 80px;top: 80px;}
}
/* 超窄手機：Header 以格線區域重新排版，讓 .sub 跟在 .logo 後面 */
@media (max-width:360px){
  header{
    display: grid;
    grid-template-columns: 1fr;
    grid-template-areas:
      "logo"
      "sub"
      "controls";
    row-gap: 6px;
  }
  .logo{ grid-area: logo; align-items: flex-start; }
  .sub{
    grid-area: sub;
    margin-left: 0;         /* 原本有的 margin-left 拿掉 */
    font-size: 13px;
    line-height: 1.4;
    text-align: left;
    word-break: keep-all;
  }
  .controls{ grid-area: controls; }
}
